import{d as G,L as H,e as x,u as A,f as V,g as O,M as Q,o as g,c as y,a,b as p,w as D,h as e,t as n,F as E,i as L,n as M,j as N,k as j,l as q,A as W,r as X,m as Y,p as ee,q as ae,v as se}from"./index-IcGHCGVg.js";import{U as I,t as z,o as Z,s as F,f as J}from"./FormSchema-aaopRgzd.js";import{V as le}from"./VerifyStore-MzkkiuHA.js";import"./AxiosBase-6-36cT8S.js";const oe={class:"modal-dialog modal-dialog-centered"},te={class:"modal-content"},ie=a("div",{class:"modal-header"},[a("h5",{class:"modal-title"},"忘記密碼")],-1),ne={class:"modal-body"},de={key:0},re=["disabled"],ce={class:"d-grid gap-8"},me={class:"d-grid gap-4"},ue={class:"d-grid gap-2"},pe=["for"],fe={class:"invalid-feedback"},_e={key:1},ve=["disabled"],he={class:"d-grid gap-8"},be={class:"d-grid gap-4"},ge={class:"d-grid gap-2"},ye=["for"],we=["name","type","value"],ke={class:"invalid-feedback"},Se={class:"d-grid gap-2"},$e=["for"],xe={class:"d-flex align-items-center gap-2"},Ve=["disabled"],Ee={class:"invalid-feedback"},Le={class:"d-grid gap-2"},Me=["for"],Fe={class:"invalid-feedback"},Ce={class:"modal-footer"},Pe=["disabled"],Be=["form","disabled"],Ue=a("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),De=a("span",null,"Loading...",-1),Te=G({__name:"ForgotModal",setup(K,{expose:C}){const{forgot:T}=I(),f=H(),{showLoading:P,hideLoading:R}=f,{emailSchema:o,codeSchema:s,newPasswordSchema:l}=J,v=le(),d=x(1),b=x(),r=A({initialValues:{email:""},validationSchema:z(Z({email:F().email(`${o.label}格式錯誤`).min(1,`請輸入${o.label}`)}).refine(i=>!b.value||i.email!==b.value,{message:`此${o.label}註冊尚未註冊`,path:["email"]}))}),{value:h}=V("email");async function w(){const{email:i}=r.values;if(!i)return;P("btn"),await v.verifyEmail(i)?await B():(b.value=i,await r.validate()),R("btn")}async function B(){const{email:i}=r.values;if(!i)return;const t=await v.generateEmailCode(i);setTimeout(()=>{t&&(d.value+=1)},0)}const _=A({initialValues:{code:"",newPassword:""},validationSchema:z(Z({code:F().min(1,`請輸入${s.label}`),newPassword:F().min(1,`請輸入${l.label}`).regex(/^(?=.*[0-9])(?=.*[a-zA-Z]).{8,}$/,`${l.label}須為 8 碼以上英數混合`)}))}),{value:k}=V("code"),{value:S}=V("newPassword");async function c(){P("btn");const{email:i}=r.values,{code:t,newPassword:u}=_.values;!i||!t||!u||(await T({code:t,newPassword:u,email:i}),U("hide"))}const $=x(),m=x();O(()=>{$.value&&(m.value=new Q($.value,{backdrop:"static",keyboard:!1}))});function U(i){if(d.value=1,r.resetForm(),!!m.value)switch(i){case"show":m.value.show();break;case"hide":m.value.hide();break}}return C({toggleForgotModal:U}),(i,t)=>(g(),y(j,null,[a("button",{type:"button",class:"btn btn-link",onClick:t[0]||(t[0]=u=>U("show"))},"忘記密碼？"),a("div",{class:"modal fade",tabindex:"-1",ref_key:"forgotModalEl",ref:$,"aria-hidden":"true","aria-labelledby":"forgotModalElLabel"},[a("div",oe,[a("div",te,[ie,a("div",ne,[d.value===1?(g(),y("section",de,[p(e(N),{onSubmit:w,id:"step1-form"},{default:D(()=>[a("fieldset",{disabled:e(f).isLoadingBtn},[a("div",ce,[a("div",me,[a("div",ue,[a("label",{for:e(o).name,class:"form-label"},n(e(o).label),9,pe),p(e(E),{modelValue:e(h),"onUpdate:modelValue":t[1]||(t[1]=u=>L(h)?h.value=u:null),modelModifiers:{trim:!0},id:e(o).name,name:e(o).name,class:M(["form-control",{"is-invalid":e(r).errors.value.email}]),placeholder:e(o).placeholder,as:e(o).as,type:e(o).type},null,8,["modelValue","id","name","placeholder","as","type","class"]),a("span",fe,n(e(r).errors.value.email),1)])])])],8,re)]),_:1})])):(g(),y("section",_e,[p(e(N),{onSubmit:c,id:"step2-form"},{default:D(()=>[a("fieldset",{disabled:e(f).isLoadingBtn},[a("div",he,[a("div",be,[a("div",ge,[a("label",{for:e(o).name,class:"form-label"},n(e(o).label),9,ye),a("input",{readonly:"",name:e(o).name,class:"form-control-plaintext",type:e(o).type,value:e(r).values.email},null,8,we),a("span",ke,n(e(r).errors.value.email),1)]),a("div",Se,[a("label",{for:e(s).name,class:"form-label"},n(e(s).label),9,$e),a("div",xe,[p(e(E),{modelValue:e(k),"onUpdate:modelValue":t[2]||(t[2]=u=>L(k)?k.value=u:null),modelModifiers:{trim:!0},id:e(s).name,name:e(s).name,class:M(["form-control",{"is-invalid":e(_).errors.value.code}]),placeholder:e(s).placeholder,as:e(s).as,type:e(s).type},null,8,["modelValue","id","name","placeholder","as","type","class"]),a("button",{type:"button",class:"btn btn-link flex-shrink-0",disabled:e(f).isLoadingBtn,onClick:B},"重發驗證信",8,Ve)]),a("span",Ee,n(e(_).errors.value.code),1)]),a("div",Le,[a("label",{for:e(l).name,class:"form-label"},n(e(l).label),9,Me),p(e(E),{modelValue:e(S),"onUpdate:modelValue":t[3]||(t[3]=u=>L(S)?S.value=u:null),modelModifiers:{trim:!0},id:e(l).name,name:e(l).name,class:M(["form-control",{"is-invalid":e(_).errors.value.newPassword}]),placeholder:e(l).placeholder,as:e(l).as,type:e(l).type},null,8,["modelValue","id","name","placeholder","as","type","class"]),a("span",Fe,n(e(_).errors.value.newPassword),1)])])])],8,ve)]),_:1})]))]),a("div",Ce,[a("button",{type:"button",class:"btn btn-outline-primary",onClick:t[4]||(t[4]=u=>U("hide")),disabled:e(f).isLoadingBtn},"關閉",8,Pe),a("button",{type:"submit",class:"btn btn-primary",form:d.value===1?"step1-form":"step2-form",disabled:d.value===1&&!e(r).meta.value.valid||d.value===2&&!e(_).meta.value.valid||e(f).isLoadingBtn},[e(f).isLoadingBtn?(g(),y(j,{key:0},[Ue,De],64)):(g(),y(j,{key:1},[q(n(d.value===1?"下一步":"送出"),1)],64))],8,Be)])])])],512)],64))}}),Re={class:"d-grid gap-8 main-pt"},je=a("div",{class:"d-grid gap-2"},[a("span",{class:"text-title text-primary"},"享樂酒店，誠摯歡迎"),a("h1",{class:"text-white"},"立即開始旅程")],-1),Ae={class:"d-grid gap-8"},Ne={class:"d-grid gap-4"},qe={class:"d-grid gap-2"},ze=["for"],Ze={class:"invalid-feedback"},Ge={class:"d-grid gap-2"},He=["for"],Ie={class:"invalid-feedback"},Je={class:"d-flex justify-content-between align-items-center"},Ke={class:"form-check"},Oe=a("label",{class:"form-check-label text-white",for:"rememberEmail"},"記住帳號",-1),Qe=["disabled"],We={class:"text-white d-flex gap-2"},sa=G({__name:"LoginView",setup(K){const{getStorageSpecifyData:C,setStorageSpecifyData:T,removeStorageSpecifyData:f}=W(),{showLoading:P,hideLoading:R}=H(),{login:o}=I(),{emailSchema:s,passwordSchema:l}=J,v=x(!1);v.value=!!C("email");const{errors:d,values:b,meta:r}=A({initialValues:{email:C("email")||"",password:""},validationSchema:z(Z({email:F().email(`${s.label}格式錯誤`).min(1,`請輸入${s.label}`),password:F().min(1,`請輸入${l.label}`)}))}),{value:h}=V("email"),{value:w}=V("password");R();const B=Y(),_=ee();async function k(){if(P(),v.value?T("email",b.email):f("email"),await o(b)){const{returnUrl:c}=_.query;B.push(c||"user/edit")}}return(S,c)=>{const $=X("router-link");return g(),y("div",Re,[je,p(e(N),{onSubmit:k},{default:D(()=>[a("div",Ae,[a("div",Ne,[a("div",qe,[a("label",{for:e(s).name,class:"form-label text-white"},n(e(s).label),9,ze),p(e(E),{modelValue:e(h),"onUpdate:modelValue":c[0]||(c[0]=m=>L(h)?h.value=m:null),modelModifiers:{trim:!0},id:e(s).name,name:e(s).name,class:M(["form-control",{"is-invalid":e(d).email}]),placeholder:e(s).placeholder,as:e(s).as,type:e(s).type},null,8,["modelValue","id","name","placeholder","as","type","class"]),a("span",Ze,n(e(d).email),1)]),a("div",Ge,[a("label",{for:e(l).name,class:"form-label text-white"},n(e(l).label),9,He),p(e(E),{modelValue:e(w),"onUpdate:modelValue":c[1]||(c[1]=m=>L(w)?w.value=m:null),modelModifiers:{trim:!0},id:e(l).name,name:e(l).name,class:M(["form-control",{"is-invalid":e(d).password}]),placeholder:e(l).placeholder,as:e(l).as,type:e(l).type},null,8,["modelValue","id","name","placeholder","as","type","class"]),a("span",Ie,n(e(d).password),1)]),a("div",Je,[a("div",Ke,[ae(a("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":c[2]||(c[2]=m=>v.value=m),id:"rememberEmail"},null,512),[[se,v.value]]),Oe]),p(Te)])]),a("button",{class:"btn btn-primary",disabled:!e(r).valid},"會員登入",8,Qe),a("div",We,[q(" 沒有會員嗎？ "),p($,{class:"link-primary text-decoration-none",to:"/register"},{default:D(()=>[q("前往註冊")]),_:1})])])]),_:1})])}}});export{sa as default};
