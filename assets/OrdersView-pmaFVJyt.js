import{d as D,C as N,p as M,r as $,o,c as l,a as t,h as y,t as i,n as b,k as v,s as A,b as m,z as d,E as P,q as V,x as F,l as g,B as R,e as w,L as E,g as j,D as q,w as S,J}from"./index-vcLWEmv1.js";import{a as H,z as C,n as U}from"./HandleDate-7JCqgiss.js";import{b as z,s as W}from"./AxiosBase-rSNDSghZ.js";const G={class:"d-flex align-items-center text-neutral"},K=t("div",{class:"customize-vr"},null,-1),Q={key:0,class:"mb-0"},X={key:1},Y={class:"card-body p-6"},Z={key:0},tt=t("strong",null,"無",-1),st=[tt],et={class:"ps-2"},T=D({__name:"ProvideItemsCard",props:{title:{type:String,default:"房內設備"},info:{type:Array,default:()=>[]},isBorder:{type:Boolean,default:!1}},setup(s){const c=s,u=N(()=>c.info.filter(r=>r.isProvide)),n=M().name||"";return(r,a)=>{const e=$("font-awesome-icon");return o(),l(v,null,[t("div",G,[K,y(n)==="rooms"||y(n)==="rooms-reservation"?(o(),l("h5",Q,[t("strong",null,i(s.title),1)])):(o(),l("strong",X,i(s.title),1))]),t("div",{class:b(["card mt-6",{"border-0":!s.isBorder}])},[t("div",Y,[t("ul",{class:b(["list-unstyled mb-0 grid gap-2",y(n)==="rooms-success"?"room-success":"room"])},[u.value.length?(o(!0),l(v,{key:1},A(u.value,(f,p)=>(o(),l("li",{key:p},[m(e,{icon:"fa-solid fa-check",class:"text-primary",size:"lg"}),t("strong",et,i(f.title),1)]))),128)):(o(),l("li",Z,st))],2)])],2)],64)}}});function ot(s){return`NT$ ${new Intl.NumberFormat("zh-TW",{style:"decimal",minimumFractionDigits:0}).format(s)}`}const lt={class:"card rounded-3 border-0"},nt={class:"card-body p-4 p-lg-8"},at={key:0,class:"mb-6 mb-lg-8"},it={class:"list-group list-group-flush d-grid gap-6 gap-lg-8"},ct={key:0,class:"list-group-item p-0"},rt=t("span",{class:"text-neutral-80 mb-2 d-block"},"預訂參考編號：",-1),dt=t("h5",{class:"mb-0"},"即將來的行程",-1),ut={class:"text-center text-primary-80 my-6 my-lg-8"},mt=t("p",{class:"mb-0 mt-2"},"沒有資料",-1),ht={class:"list-group list-group-flush d-grid gap-6 gap-lg-8"},_t={class:"list-group-item px-0 pt-0 pb-6 pb-lg-8"},ft={class:"text-neutral-80 mb-2 d-block"},bt=t("h5",{class:"mb-0"},"即將來的行程",-1),gt=["src","alt"],yt={class:"list-unstyled mb-0"},vt={key:0,class:"text-neutral-80 mb-4"},pt={class:"mb-0 d-flex align-items-center text-neutral-80"},kt=t("div",{class:"vr bg-neutral-60 mx-3"},null,-1),xt={key:1,class:"mb-4 d-grid gap-2"},wt={class:"d-block"},$t={class:"d-block"},It={class:"d-flex align-items-center"},Ot=t("div",{class:"customize-vr"},null,-1),St={key:0},Ht={class:"d-flex align-items-center"},Dt=t("div",{class:"customize-vr bg-neutral-60"},null,-1),Ct={key:0},zt={class:"fw-bold"},Tt={key:0,class:"list-group-item p-0 d-grid gap-6 gap-lg-8"},B=D({__name:"OrderDetailCard",props:{orderDetails:{type:Array,default:()=>[]},isHistory:{type:Boolean,default:!1},isShowAll:{type:Boolean,default:!1}},setup(s){const c=s,u=N(()=>c.orderDetails.filter(n=>n));function h(n){const{roomId:r,checkInDate:a,checkOutDate:e}=n,f=H(a,e,!0);return ot(r.price*f)}return(n,r)=>{const a=$("font-awesome-icon");return o(),l("div",lt,[t("div",nt,[s.isHistory?(o(),l("h5",at,"歷史訂單")):d("",!0),t("ul",it,[u.value.length?(o(!0),l(v,{key:1},A(u.value,(e,f)=>V((o(),l("li",{key:e._id,class:b(["list-group-item p-0",{"none-border-style":f==2&&!s.isShowAll}])},[t("ul",ht,[t("li",_t,[s.isHistory?d("",!0):(o(),l(v,{key:0},[t("span",ft,"預訂參考編號："+i(e._id),1),bt],64)),t("div",{class:b({"d-flex flex-column flex-lg-row flex-lg-column flex-xl-row":s.isHistory})},[t("img",{class:b([s.isHistory?"isHistoryImgSize me-lg-6 mb-6 mb-lg-0 mb-lg-6 mb-xl-0 flex-shrink-0":"my-6 my-lg-8","rounded roomImgHeight"]),src:e.roomId.imageUrl,alt:e.roomId.name},null,10,gt),t("ul",yt,[s.isHistory?(o(),l("li",vt," 預訂參考編號："+i(e._id),1)):d("",!0),t("li",{class:b(["fw-bold",s.isHistory?"mb-4":"mb-6"])},[t("h6",pt,[g(i(e.roomId.name),1),s.isHistory?d("",!0):(o(),l(v,{key:0},[g("，"+i(y(H)(e.checkInDate,e.checkOutDate))+" ",1),kt,g(" 住宿人數："+i(e.peopleNum)+" 位 ",1)],64))])],2),s.isHistory?(o(),l("li",xt,[t("span",wt," 住宿天數："+i(y(H)(e.checkInDate,e.checkOutDate)),1),t("span",$t," 住宿人數："+i(e.peopleNum)+" 位 ",1)])):d("",!0),t("li",{class:b([s.isHistory?"mb-4":"mb-6 fw-bold","d-grid gap-2"])},[t("div",It,[Ot,t("section",null,[g(" 入住："+i(y(C)(e.checkInDate)),1),s.isHistory?d("",!0):(o(),l("span",St,"，15:00 可入住"))])]),t("div",Ht,[Dt,t("section",null,[g(" 退房："+i(y(C)(e.checkOutDate)),1),s.isHistory?d("",!0):(o(),l("span",Ct,"，12:00 前退房"))])])],2),t("li",zt,i(h(e)),1)])],2)]),s.isHistory?d("",!0):(o(),l("li",Tt,[t("section",null,[m(T,{isBorder:!0,info:e.roomId.facilityInfo,title:"房內設備"},null,8,["info"])]),t("section",null,[m(T,{isBorder:!0,info:e.roomId.amenityInfo,title:"備品提供"},null,8,["info"])])]))])],2)),[[F,f<3||s.isShowAll]])),128)):(o(),l("li",ct,[s.isHistory?d("",!0):(o(),l(v,{key:0},[rt,dt],64)),t("div",ut,[m(a,{icon:"fa-solid fa-inbox",size:"4x"}),mt])]))]),P(n.$slots,"default")])])}}}),Bt=R("OrderStore",()=>{const s=w([]);function c(){return z.get("orders").then(({result:h})=>(s.value=h,Promise.resolve(s.value))).catch(h=>Promise.reject(!1))}function u(h){return z.delete(`orders/${h}`).then(n=>c()).then(n=>(W("toast","success","取消訂單成功","您的訂單已取消"),Promise.resolve(!0))).catch(n=>Promise.reject(!1))}return{myOrders:s,getMyOrders:c,cancelOrder:u}}),Nt={class:"row gap-6 gap-lg-8 g-0"},At={class:"col-lg"},Lt={key:0,class:"row align-items-center gx-4 mt-6 mt-lg-8"},Mt=t("div",{class:"col-6 col-sm order-sm-1"},[t("button",{type:"button",class:"btn btn-outline-primary w-100","data-bs-toggle":"modal","data-bs-target":"#cancelOrderModal"},"取消預訂")],-1),Pt={class:"col-6 col-sm order-sm-2"},Vt={class:"col-6 col-sm-auto mt-4 mt-sm-0 text-center text-sm-start order-sm-0"},Ft=["disabled"],Rt=t("span",{class:"d-sm-none ms-1"},"上一筆",-1),Et={class:"col-6 col-sm-auto mt-4 mt-sm-0 text-center text-sm-start order-4"},jt=["disabled"],qt=t("span",{class:"d-sm-none me-1"},"下一筆",-1),Jt={class:"col-lg-5"},Ut=J('<div class="modal-header d-lg-none"><span class="text-subtitle text-neutral">取消預訂</span><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><button type="button" class="btn-close d-none d-lg-block" data-bs-dismiss="modal" aria-label="Close"></button><h6 class="text-center text-neutral-80">確定要取消此房型的預訂嗎？</h6></div>',2),Wt=t("button",{type:"button",class:"btn btn-outline-primary flex-fill","data-bs-dismiss":"modal"},"關閉視窗",-1),Yt=D({__name:"OrdersView",setup(s){const c=Bt(),{showLoading:u,hideLoading:h}=E(),n=w([]),r=w([]),a=w(0),e=w(!1);j(async()=>{u(),await c.getMyOrders()}),q(()=>c.myOrders,p=>{n.value=[],r.value=[];const _=new Date().getTime();p.forEach(k=>{const{checkInDate:x,status:L}=k;U(x).getTime()+7*60*60*1e3>=_&&L===0?(n.value.push(k),n.value.sort((I,O)=>I.checkInDate>O.checkInDate?1:-1)):(r.value.push(k),r.value.sort((I,O)=>I.checkInDate>O.checkInDate?-1:1))}),h()},{deep:!0});async function f(){u();const{_id:p}=n.value[a.value];await c.cancelOrder(p)&&(a.value--,0>a.value&&(a.value=0))}return(p,_)=>{const k=$("RouterLink"),x=$("font-awesome-icon");return o(),l(v,null,[t("div",Nt,[t("div",At,[m(B,{orderDetails:[n.value[a.value]]},{default:S(()=>[n.value.length?(o(),l("div",Lt,[Mt,t("div",Pt,[m(k,{class:"btn btn-primary w-100 disabled",to:"#"},{default:S(()=>[g("查看詳情")]),_:1})]),t("div",Vt,[t("button",{disabled:a.value===0,type:"button",class:"btn btn-link",onClick:_[0]||(_[0]=()=>a.value--)},[m(x,{icon:"fa-solid fa-angle-left",size:"lg","fixed-width":""}),Rt],8,Ft)]),t("div",Et,[t("button",{disabled:a.value>=n.value.length-1,type:"button",class:"btn btn-link",onClick:_[1]||(_[1]=()=>a.value++)},[qt,m(x,{icon:"fa-solid fa-angle-right",size:"lg","fixed-width":""})],8,jt)])])):d("",!0)]),_:1},8,["orderDetails"])]),t("div",Jt,[m(B,{orderDetails:r.value,isHistory:!0,isShowAll:e.value},{default:S(()=>[r.value.length?(o(),l("button",{key:0,type:"button",class:"btn btn-outline-primary w-100",onClick:_[2]||(_[2]=()=>e.value=!e.value)},[g(" 查看更多"),m(x,{icon:e.value?"fa-solid fa-angle-up":"fa-solid fa-angle-down",class:"ms-1"},null,8,["icon"])])):d("",!0)]),_:1},8,["orderDetails","isShowAll"])])]),t("div",{class:"modal fade",id:"cancelOrderModal",tabindex:"-1","aria-labelledby":"cancelOrderModalLabel","aria-hidden":"true"},[t("div",{class:"modal-dialog modal-dialog-centered"},[t("div",{class:"modal-content"},[Ut,t("div",{class:"modal-footer"},[Wt,t("button",{type:"button",class:"btn btn-primary flex-fill","data-bs-dismiss":"modal",onClick:f},"確定取消")])])])])],64)}}});export{Yt as default};
